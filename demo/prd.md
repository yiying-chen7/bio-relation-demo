# BioRelation：微生物-代谢物知识图谱平台

## 项目概述

BioRelation是一个综合平台，旨在从生物医学文献中提取、结构化和支持探索微生物（细菌、真菌、古菌）和代谢物之间的关系。该系统处理来自PubMed的科学论文，构建微生物-代谢物相互作用的知识库，利用NLP技术、知识图谱技术和向量搜索能力使这些专业知识可访问和可查询。这是一个学术研究项目，专注于推进微生物代谢领域的科学知识。

## 研究目标

1. 从科学文献中创建微生物-代谢物关系的综合知识库
2. 使研究人员能够快速找到微生物和代谢物之间的特定关系
3. 通过基于图的探索和语义搜索支持发现新的连接
4. 减少研究人员在微生物-代谢物相互作用文献综述上花费的时间
5. 为进一步的生物信息学研究和潜在的药物发现应用提供基础

## 用户需求

### 核心用户故事

1. **文献收集和管理**
   - 用户需要收集和管理大量科学文献（400,000+篇论文）
   - 用户需要过滤出专门包含微生物和代谢物实体的相关论文
   - 用户需要大规模处理文献，处理不同格式和大量数据

2. **实体提取**
   - 用户需要识别论文中提到的微生物（细菌、真菌等，但不包括病毒）
   - 用户需要识别论文中提到的代谢物
   - 用户需要提取这些实体的上下文信息（分类学、化学性质等）

3. **关系提取**
   - 用户需要识别微生物和代谢物之间的关系（产生、消耗、调节等）
   - 用户需要捕获这些关系的方向性和性质
   - 用户需要提取支持每种关系的证据/上下文
   - 用户需要基于统计显著性和使用的语言评估关系强度（强/弱/未知）
   - 用户需要纳入文献影响因子或自定义影响评分

4. **实体消歧**
   - 用户需要将实体引用解析为规范形式（处理同义词、缩写）
   - 用户需要将实体链接到外部知识库（NCBI分类学、KEGG等）
   - 用户需要确保知识库中实体表示的一致性

5. **知识探索**
   - 用户需要查询特定关系（例如"哪些微生物产生丁酸盐？"）
   - 用户需要探索知识图谱以找到间接连接
   - 用户需要搜索支持特定声明或关系的文献

6. **语义搜索**
   - 用户需要使用自然语言查询查找相关信息
   - 用户需要检索与其特定问题最相关的文献段落
   - 用户需要从知识库获取合成的答案

### 次要用户故事

1. **数据导出**
   - 用户需要导出知识图谱的子集进行进一步分析
   - 用户需要生成关系网络的可视化

2. **系统管理**
   - 管理员需要监控系统性能和数据处理管道
   - 管理员需要用新文献更新知识库
   - 管理员需要管理用户访问和安全

## 技术需求

### 数据获取

1. **文献爬取**
   - 系统必须使用优化的搜索查询高效爬取PubMed，组合微生物和代谢物术语
   - 系统必须实现全面的搜索查询，涵盖：
     - **微生物术语**：Bacter*, Bacilli, Fung*, Archaea*, Microb*, "gut flora", Lactobacill*, Clostrid*, "E. coli"等
     - **代谢物术语**：Metabol*, "compound*", SCFA*, "bile acid*", "amino acid*", "fatty acid*"等
   - 系统必须提取详细元数据，包括PMID、标题、摘要、期刊详情、作者、日期、MeSH术语和物质
   - 系统必须处理速率限制，使用可配置的批次大小（PMID_BATCH_SIZE, DETAIL_BATCH_SIZE）
   - 系统必须实现重试机制和会话管理以保持稳定性
   - 系统必须跟踪爬取进度并支持可恢复操作

2. **数据清洗**
   - 系统必须标准化文档格式和字符编码
   - 系统必须使用PMID去重并正确解决冲突，移除重复论文
   - 系统必须规范化元数据字段，包括日期、期刊名称和作者
   - 系统必须通过删除HTML标签、特殊字符和标准化空白来规范化文本内容
   - 系统必须基于包含/排除标准过滤文章，包括文章类型

### 数据处理

1. **实体识别**
   - 系统必须使用综合微生物词汇（细菌、真菌、古菌术语）识别微生物实体
   - 系统必须使用综合代谢物词汇（化合物、SCFAs等）识别代谢物实体
   - 系统必须提取详细实体元数据，包括微生物的分类学和代谢物的化学性质
   - 系统必须实现共现检测以过滤包含两种实体类型的文章
   - 系统必须捕获上下文信息，包括微生物的来源/环境和代谢物的结构信息

2. **模型适应**
   - 系统必须支持API和自托管模型的混合方法：
     - 用于初始开发和复杂情况的API提取（5,000篇论文）
     - 用于大规模处理的自托管微调模型（400,000+篇论文）
   - 系统必须实现参数高效微调（LoRA/QLoRA）以最小化GPU内存需求
   - 系统必须支持量化（8位/4位）以高效推理
   - 系统必须包括动态批处理以优化GPU利用率
   - 系统必须根据复杂性和资源可用性实现API和本地模型之间的智能路由

3. **关系提取**
   - 系统必须识别实体之间的关系类型（产生、抑制、激活等）及其本体ID
   - 系统必须提取方向信息（主体、谓词、客体）
   - 系统必须捕获证据文本和实验方法
   - 系统必须基于以下因素评估关系强度（强/弱/未知）：
     - 统计显著性指标（p值）
     - 强度关键词（"significantly"、"markedly"等）
     - 作者确定性评估
   - 系统必须纳入文献影响评估：
     - 期刊影响因子映射
     - 基于引用的指标
     - 内容价值评估
   - 系统必须将关系链接到文本中的支持证据

4. **实体消歧**
   - 系统必须使用MeSH本体将实体解析为规范形式
   - 系统必须实现多种匹配策略（精确、部分、基于标记的匹配）
   - 系统必须处理同义词、缩写和命名变体
   - 系统必须分配MeSH ID和树码到标准化实体
   - 系统必须一致处理JSONL和CSV格式

### 数据存储

1. **知识图谱**
   - 系统必须在Neo4j图数据库中存储实体和关系
   - 系统必须实现详细的属性模型，捕获所有实体属性和关系元数据
   - 系统必须支持高效图遍历和模式匹配
   - 系统必须维护出处信息（来源论文、时间戳）
   - 系统必须包括关系强度和影响因子指标

2. **向量数据库**
   - 系统必须在Milvus向量数据库中存储文档嵌入
   - 系统必须实现带可配置大小和重叠的文档分块
   - 系统必须支持高效相似度搜索
   - 系统必须将向量表示链接到原始文本段落和实体提及

### 用户界面

1. **搜索界面**
   - 系统必须提供自然语言查询界面
   - 系统必须返回相关段落和结构化关系
   - 系统必须在结果中突出显示实体和关系
   - 系统必须呈现置信度级别和支持证据

2. **图探索**
   - 系统必须可视化相关实体的子图
   - 系统必须支持知识图谱的交互式探索
   - 系统必须提供按关系强度和文献影响的过滤功能

### 系统架构

1. **可扩展性**
   - 系统必须处理400,000+篇论文，原始大小约为953MB
   - 系统必须支持用新文献进行增量更新
   - 系统必须通过批处理的GPU加速高效管理计算资源
   - 系统必须在适用情况下实现并行处理

2. **性能**
   - 系统必须在2秒内响应用户查询
   - 系统必须以最佳资源利用率完成批处理任务
   - 系统必须为频繁操作实现缓存策略
   - 系统必须优化向量搜索性能以进行语义检索

3. **安全性**
   - 系统必须保护数据完整性
   - 系统必须提供适当的访问控制
   - 系统必须记录系统活动以供审计之用

## 约束和限制

1. **数据访问**
   - 有限的全文文章访问可能需要主要处理摘要
   - PubMed API速率限制需要谨慎的请求管理

2. **计算资源**
   - 基于API的处理受到大规模处理的成本约束
   - GPU资源限于租用基础（例如A100，1个月）
   - 模型微调和推理需要内存优化技术
   - 项目优先考虑高效资源利用而非穷尽处理

3. **领域知识**
   - 微生物学和生物化学领域具有复杂术语
   - 实体消歧需要专业知识资源（MeSH树）

4. **模型准确性**
   - NER和关系提取模型具有固有错误率
   - 某些关系可能被遗漏或错误识别
   - 微调模型需要对照API质量进行仔细评估

## 成功标准

1. **覆盖率**
   - 成功处理目标文献语料库的>95%（约400,000篇论文）
   - 提取文本中提到的>90%微生物和代谢物实体
   - 捕获实体之间明确陈述的>80%关系

2. **准确性**
   - 实体识别达到>85%精确率
   - 关系提取达到>80%精确率
   - 实体消歧到规范形式达到>90%准确率

3. **资源效率**
   - 在租用GPU资源的约束内完成大规模处理
   - 实现最大化GPU利用率的推理批量大小
   - 通过模型微调将API成本降低至少70%

4. **系统性能**
   - 在没有显著性能下降的情况下处理并发查询
   - 在高效时间范围内完成新文献批次的处理
   - 维持系统正常运行时间>99%

## 实施方法

该项目将实施混合方法，平衡质量和资源约束：

### 混合处理策略

1. **基于API的处理**（初始开发）
   - 使用基于API的提取处理小子集（~5,000篇论文）
   - 使用这些数据验证提取管道
   - 创建用于模型微调的训练数据集
   - 为微调模型建立质量基准

2. **微调模型处理**（大规模处理）
   - 在较小基础模型（7-8B参数）上实现参数高效微调（LoRA/QLoRA）
   - 使用量化（8位/4位）优化模型内存效率
   - 实现带动态批量大小的批处理
   - 使用微调模型处理完整语料库（400,000+篇论文）

3. **基于复杂性的路由**
   - 将复杂或困难情况路由到API处理
   - 用本地微调模型处理标准情况
   - 实现自动路由决策的置信度阈值

### 资源优化

1. **GPU利用**
   - 调度GPU密集型任务以最大化租用资源利用率
   - 实现内存优化技术（梯度累积、混合精度等）
   - 使用高效注意力机制和模型优化

2. **处理效率**
   - 实现多线程和并行处理
   - 使用基于检查点的处理以支持可恢复性
   - 基于可用资源优化批量大小

## 分阶段交付

项目将分阶段交付，以管理复杂性并提供增量价值：

### 第1阶段：数据管道和实体提取
- 实现PubMed爬取，优化批处理和错误处理
- 开发全面的数据清洗管道，包括去重和规范化
- 实现微生物和代谢物的实体提取，包括详细元数据
- 实现共现过滤以专注于相关文献

### 第2阶段：模型训练和关系提取
- 建立模型微调基础设施
- 开发训练数据准备管道
- 为实体和关系提取微调领域特定模型
- 实现带强度评估的关系提取
- 使用MeSH本体开发实体消歧

### 第3阶段：知识图谱和向量数据库
- 设计和实现Neo4j知识图谱
- 设置Milvus向量数据库，包括文档分块和嵌入
- 开发数据库间交叉引用
- 实现高效索引和查询优化

### 第4阶段：用户界面和集成
- 开发搜索和探索界面
- 实现检索增强生成能力
- 将所有组件集成为凝聚系统
- 部署并优化性能

## 资源需求

- 开发环境：带Git和Cursor代码助手的本地开发
- 处理环境：带16+CPU核心、64GB+内存、A100 GPU（租用基础，1个月）的服务器
- 存储：总计30GB（最小）
- 数据库服务器：Neo4j和Milvus实例
- API服务器：4+CPU核心，16GB+内存
- 开发工具：Python、FastAPI、React/Vue、Docker、PyTorch/Transformers

## 评估和验证

1. **数据质量评估**
   - 对照手动标记样本验证实体提取
   - 将关系提取与人类专家评估进行比较
   - 对照参考本体测量消歧准确性

2. **性能评估**
   - 在各种负载条件下对查询响应时间进行基准测试
   - 测量不同批量大小的处理吞吐量
   - 评估内存使用和资源效率

3. **用户验证**
   - 与领域专家进行用户测试
   - 收集关于结果质量和相关性的反馈
   - 基于用户见解进行迭代

## 未来扩展

1. **增强分析**
   - 实现关系发现的图分析
   - 添加未知关系的预测能力
   - 开发跨文献的趋势分析

2. **模型改进**
   - 通过持续微调进一步领域适应
   - 探索联合实体和关系提取的多任务模型
   - 实现更复杂的置信度评分

3. **扩展覆盖范围**
   - 包括其他实体类型（基因、蛋白质等）
   - 扩展到其他生物医学领域
   - 在可用时纳入全文处理

## 项目进展更新（2023-11-26）

### M1.1 数据获取阶段完成情况

我们已成功完成项目的第一阶段里程碑（M1.1 数据获取完成），具体成果如下：

1. **PubMed爬虫系统实现**
   - 开发了模块化PubMed爬虫系统，分为五个功能阶段：系统初始化、文献检索、详情获取、自适应爬取和命令行接口
   - 优化了查询语句，实现了层次化搜索策略（核心层和扩展层）
   - 开发了相关性评分和查询优化组件，支持自适应爬取功能
   - 实现了断点续传和失败批次重试机制，提高大规模爬取可靠性

2. **查询策略创新**
   - 原始查询过于宽泛（290万篇文章），经过优化和层次化设计降至目标量级（约40万篇）
   - 开发了核心层、扩展层和自适应爬取三种互补的检索策略
   - 删除或限制了高噪声术语（compound*、chemical*、enzyme*等）
   - 添加了排除非研究类文章和病毒研究的过滤条件

3. **系统健壮性增强**
   - 实现了API请求批处理和速率限制，符合PubMed使用规范
   - 采用POST请求方式解决长查询字符串问题
   - 开发了安全的XML解析功能，处理复杂的文献结构
   - 优化了内存使用和批处理参数，支持大规模爬取

4. **自适应功能特点**
   - 自适应爬虫建立在初始查询（通常是核心查询）基础上，但能动态优化查询条件
   - 通过分析已获取文献的相关性提取新的术语和关系，逐步改进查询精确度
   - 同时提供相关性评分，能够过滤低相关性文献，为下一阶段数据标准化准备高质量输入
   - 相比静态的两层查询，能发现潜在相关但未被预定义术语覆盖的文献

### 与需求对比

本阶段实现完全满足PRD中定义的"文献爬取"需求，包括：
- 使用优化的搜索查询高效爬取PubMed ✓
- 实现全面搜索查询，涵盖微生物和代谢物术语 ✓
- 提取详细元数据（PMID、标题、摘要、期刊详情等） ✓
- 处理速率限制，使用可配置批次大小 ✓
- 实现重试机制和会话管理保持稳定性 ✓
- 跟踪爬取进度并支持可恢复操作 ✓

### 下一步工作

随着数据获取阶段的完成，我们即将开始M1.2数据标准化阶段，主要工作包括：
- 使用爬虫系统获取一批测试数据（约5000篇文献）
- 开发数据清洗流程，标准化文档格式和字符编码
- 实现PMID去重和元数据规范化
- 开发基于包含/排除标准的文章过滤机制
